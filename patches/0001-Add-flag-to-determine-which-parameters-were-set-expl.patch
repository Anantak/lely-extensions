From 41a8307b373bf037c83871922ea0ff9cbb1bdd46 Mon Sep 17 00:00:00 2001
From: Florian Mayer <info@sans-ltd.com>
Date: Wed, 14 Oct 2020 17:37:18 +0200
Subject: [PATCH] Add flag to determine which parameters were set explicitely.

# Conflicts:
#	lely-core/src/co/dcf.c
---
 lely-core/include/lely/co/obj.h | 4 ++++
 lely-core/src/co/dcf.c          | 2 ++
 2 files changed, 6 insertions(+)

diff --git a/lely-core/include/lely/co/obj.h b/lely-core/include/lely/co/obj.h
index 4b32d5ca2..cdeb8902a 100644
--- a/lely-core/include/lely/co/obj.h
+++ b/lely-core/include/lely/co/obj.h
@@ -113,6 +113,10 @@
 /// The current object value is of the form `$NODEID { "+" number }`.
 #define CO_OBJ_FLAGS_VAL_NODEID 0x80
 
+/// The current object value (ParameterValue) was explicitly set in the DCF file.
+#define CO_OBJ_FLAGS_VAL_SET_EXPLICITLY 0x100
+
+
 /// The CANopen SDO upload/download request struct from <lely/co/sdo.h>.
 struct co_sdo_req;
 
diff --git a/lely-core/src/co/dcf.c b/lely-core/src/co/dcf.c
index 96be30e5b..d52408145 100644
--- a/lely-core/src/co/dcf.c
+++ b/lely-core/src/co/dcf.c
@@ -844,6 +844,8 @@ co_sub_parse_cfg(co_sub_t *sub, const config_t *cfg, const char *section)
 			diag_at(DIAG_ERROR, get_errc(), &at,
 					"unable to parse ParameterValue");
 			goto error;
+		} else {
+			sub->flags |= CO_OBJ_FLAGS_VAL_SET_EXPLICITLY;
 		}
 		if (sub->flags & CO_OBJ_FLAGS_VAL_NODEID)
 			co_val_set_id(type, sub->val, id);
-- 
2.27.0.windows.1

